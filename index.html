<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Wedding Photobooth</title>

<style>
body{
margin:0;
font-family:Georgia,serif;
background:linear-gradient(to bottom,#faf6f0,#f2e8dc);
display:flex;
height:100vh;
overflow:hidden;
color:#444;
}

.sidebar{
width:130px;
display:flex;
flex-direction:column;
gap:12px;
padding:20px 10px;
box-sizing:border-box;
}

button{
border:none;
padding:12px;
border-radius:999px;
font-weight:600;
cursor:pointer;
box-shadow:0 6px 15px rgba(0,0,0,.08);
color:#444;
}

.albumBtn{background:linear-gradient(135deg,#f7e7ce,#e8cfa5);}
.uploadBtn{background:linear-gradient(135deg,#f5e6e8,#e6cfd2);}
.saveBtn{background:linear-gradient(135deg,#e6d7b9,#d4b483);}

.main{
flex:1;
display:flex;
align-items:center;
justify-content:flex-end;
padding-right:30px;
}

canvas{
height:95vh;
width:auto;
max-width:100%;
touch-action:none;
}

/* Album */
#albumOverlay{
display:none;
position:fixed;
inset:0;
background:rgba(0,0,0,0.85);
z-index:3000;
flex-direction:column;
align-items:center;
justify-content:center;
}

#albumOverlay img{
max-width:95vw;
max-height:80vh;
border-radius:16px;
box-shadow:0 10px 40px rgba(0,0,0,0.5);
cursor:pointer;
}

.thumbRow{
display:flex;
gap:12px;
margin-top:20px;
}

.thumbRow img{
width:80px;
height:80px;
object-fit:cover;
border-radius:12px;
border:3px solid white;
cursor:pointer;
}
</style>
</head>

<body>

<div class="sidebar">
<button class="albumBtn" onclick="openAlbum()">Wedding Album</button>
<button class="uploadBtn" onclick="openUpload()">Upload</button>
<button class="saveBtn" onclick="saveImage()">Save</button>
</div>

<div class="main">
<canvas id="canvas" width="707" height="2000"></canvas>
</div>

<input type="file" id="fileInput" accept="image/*" style="display:none">

<div id="albumOverlay">
<img id="preview">
<div class="thumbRow">
<img src="line_oa_chat_260228_065917_group_0.jpg">
<img src="line_oa_chat_260228_065917_group_1.jpg">
<img src="line_oa_chat_260228_065917_group_2.jpg">
<img src="line_oa_chat_260228_065917_group_3.jpg">
<img src="line_oa_chat_260228_065917_group_4.jpg">
<img src="line_oa_chat_260228_065917_group_5.jpg">
<img src="line_oa_chat_260228_065917_group_6.jpg">
<img src="line_oa_chat_260228_065917_group_7.jpg">
<img src="line_oa_chat_260228_065917_group_8.jpg">
<img src="line_oa_chat_260228_065917_group_9.jpg">
</div>
<button onclick="closeAlbum()" style="margin-top:20px;padding:8px 16px;border-radius:999px;">Close</button>
</div>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const fileInput=document.getElementById("fileInput");
const overlay=document.getElementById("albumOverlay");
const preview=document.getElementById("preview");
const thumbs=document.querySelectorAll(".thumbRow img");

const frame=new Image();
frame.src="Photobooth (6).png";

const slots=[
{x:45,y:53,w:617,h:444},
{x:45,y:562,w:617,h:444},
{x:45,y:1071,w:617,h:444}
];

let images=slots.map(()=>({img:null,x:0,y:0,scale:1,minScale:1,maxScale:4}));
let active=-1;

/* เลือกช่อง */
canvas.addEventListener("click",e=>{
const r=canvas.getBoundingClientRect();
const x=(e.clientX-r.left)*(canvas.width/r.width);
const y=(e.clientY-r.top)*(canvas.height/r.height);
active=-1;
slots.forEach((s,i)=>{
if(x>s.x&&x<s.x+s.w&&y>s.y&&y<s.y+s.h) active=i;
});
});

/* โหลดรูป */
function loadImage(src){
const img=new Image();
img.onload=()=>{
const s=slots[active];
const baseScale=s.w/img.width;
images[active]={
img,
x:0,
y:0,
scale:baseScale,
minScale:baseScale,
maxScale:baseScale*4
};
};
img.src=src;
}

/* Album */
function openAlbum(){
if(active===-1){alert("Select frame first");return;}
overlay.style.display="flex";
preview.src=thumbs[0].src;
}
function closeAlbum(){overlay.style.display="none";}
thumbs.forEach(t=>t.onclick=()=>preview.src=t.src);
preview.onclick=()=>{loadImage(preview.src);closeAlbum();}

/* Upload */
function openUpload(){
if(active===-1){alert("Select frame first");return;}
fileInput.click();
}
fileInput.onchange=e=>{
const reader=new FileReader();
reader.onload=ev=>loadImage(ev.target.result);
reader.readAsDataURL(e.target.files[0]);
};

/* Touch */
let isDragging=false,startX=0,startY=0,startDist=0,startScale=1;

canvas.addEventListener("touchstart",e=>{
if(active===-1)return;
if(e.touches.length===1){
isDragging=true;
startX=e.touches[0].clientX;
startY=e.touches[0].clientY;
}
if(e.touches.length===2){
isDragging=false;
startDist=getDist(e.touches[0],e.touches[1]);
startScale=images[active].scale;
}
},{passive:false});

canvas.addEventListener("touchmove",e=>{
if(active===-1)return;
e.preventDefault();

let d=images[active];
let s=slots[active];

if(e.touches.length===1 && isDragging){
let dx=e.touches[0].clientX-startX;
let dy=e.touches[0].clientY-startY;
d.x+=dx;
d.y+=dy;
startX=e.touches[0].clientX;
startY=e.touches[0].clientY;
}

if(e.touches.length===2){
let newDist=getDist(e.touches[0],e.touches[1]);
let ratio=newDist/startDist;
let newScale=startScale*ratio;
newScale=Math.max(d.minScale,Math.min(d.maxScale,newScale));

let rect=canvas.getBoundingClientRect();
let centerX=((e.touches[0].clientX+e.touches[1].clientX)/2-rect.left)*(canvas.width/rect.width);
let centerY=((e.touches[0].clientY+e.touches[1].clientY)/2-rect.top)*(canvas.height/rect.height);

let imgCenterX=s.x+s.w/2+d.x;
let imgCenterY=s.y+s.h/2+d.y;

let dx=centerX-imgCenterX;
let dy=centerY-imgCenterY;

d.x-=dx*(newScale/d.scale-1);
d.y-=dy*(newScale/d.scale-1);
d.scale=newScale;
}

if(d.img){
let iw=d.img.width*d.scale;
let ih=d.img.height*d.scale;
let maxX=Math.max(0,(iw-s.w)/2);
let maxY=Math.max(0,(ih-s.h)/2);
d.x=Math.min(maxX,Math.max(-maxX,d.x));
d.y=Math.min(maxY,Math.max(-maxY,d.y));
}
},{passive:false});

canvas.addEventListener("touchend",()=>isDragging=false);

function getDist(a,b){
return Math.hypot(b.clientX-a.clientX,b.clientY-a.clientY);
}

/* Draw */
function draw(includeHighlight=true){
ctx.clearRect(0,0,707,2000);

slots.forEach((s,i)=>{
let d=images[i];

if(d.img){
ctx.save();
ctx.beginPath();
ctx.rect(s.x,s.y,s.w,s.h);
ctx.clip();
let iw=d.img.width*d.scale;
let ih=d.img.height*d.scale;
ctx.drawImage(d.img,
s.x+(s.w-iw)/2+d.x,
s.y+(s.h-ih)/2+d.y,
iw,ih);
ctx.restore();
}

if(includeHighlight && i===active){
ctx.strokeStyle="#d4b483";
ctx.lineWidth=6;
ctx.strokeRect(s.x,s.y,s.w,s.h);
}
});

if(frame.complete) ctx.drawImage(frame,0,0,707,2000);

if(includeHighlight)
requestAnimationFrame(()=>draw(true));
}
draw(true);

/* Save */
function saveImage(){
draw(false);
canvas.toBlob(blob=>{
const file=new File([blob],"Wedding.png",{type:"image/png"});
if(navigator.canShare && navigator.canShare({files:[file]})){
navigator.share({files:[file],title:"Wedding Photobooth"});
}else{
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="Wedding.png";
a.click();
}
draw(true);
});
}
</script>

</body>
</html>



